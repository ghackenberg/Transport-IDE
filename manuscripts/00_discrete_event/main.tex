%%%%%%%%%%%%%%%%%%%% author.tex %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% sample root file for your "contribution" to a contributed volume
%
% Use this file as a template for your own input.
%
%%%%%%%%%%%%%%%% Springer %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% RECOMMENDED %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[graybox]{svmult}

% choose options for [] as required from the list
% in the Reference Guide
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage[colorlinks,linkcolor=blue]{hyperref}
\usepackage{todonotes}
\usepackage{type1cm}        % activate if the above 3 fonts are
                            % not available on your system
%
\usepackage{makeidx}         % allows index generation
\usepackage{graphicx}        % standard LaTeX graphics tool
                             % when including figure files
\usepackage{multicol}        % used for the two-column index
\usepackage[bottom]{footmisc}% places footnotes at page bottom


\usepackage{newtxtext}       % 
\usepackage[varvw]{newtxmath}       % selects Times Roman as basic font
\usepackage{wrapfig}

% see the list of further useful packages
% in the Reference Guide

\makeindex             % used for the subject index
                       % please use the style svind.ist with
                       % your makeindex program

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

 \title*{\textbf{TransportIDE} -- An integrated transportation system design and simulation environment}
\titlerunning{TransportIDE} 
\author{Dominik Ascher and Georg Hackenberg}
% Use \authorrunning{Short Title} for an abbreviated version of
% your contribution title if the original one is too long
\institute{Dominik Ascher \at Distributed Artificial Intelligence Laboratory, Faculty of Electrical Engineering and Computer Science, Technical University of Berlin, 10587 Berlin, Germany, \email{ascher@tu-berlin.de}
	\and Georg Hackenberg \at School of Engineering, University of Applied Sciences Upper Austria, 4600 Wels, Austria,
	\email{georg.hackenberg@fh-wels.at}}
%
% Use the package "url.sty" to avoid
% problems with special characters
% used in your e-mail or web address
%
\maketitle

%\abstract*{AA.}

\abstract{Due to many reasons transportation systems have to become more and more efficient.
	This observation holds true both for person transport and for good transport, on public infrastructure and on private infrastructure.
	Designing efficient transportation systems is a difficult undertaking due to the vast size of the solution space and the emergent dynamics of the system components.
	Transportation system designers need appropriate tools to explore the design space and test solutions quickly and reliably.
	In this paper, we propose a simulation-based environment for transportation system design and test, which is built on a solid system theory.
	Furthermore, we demonstrate possible applications such as comparison of different infrastructure and control algorithm designs.}

  \section{Introduction}
\label{sec:intro}

Meeting sustainability goals \cite{sachs2019six} is a driving factor of the transformation of transportation systems and increasing their efficiency. However, with respect to most efficient design and operation, deriving sound infrastructure and control strategies for as well as the interconnection between intelligent transportation systems (ITS) and services poses fundamental challenges. In addition, quality assurance of these systems and services is a critical challenge within the system-of-systems they act within, as the latter are made up of constituting systems and services with heterogenous goals and stakeholders, which are fundamentally required by intelligent and connected transportation paradigms. For this, systematic development methods addressing these challenges and emerging domain paradigms are required.    

Demand-responsive transport \cite{brake_demand_2004} as well as the transportation electrification \cite{pereirinha2018main} represent two current key emerging domain paradigms in transportation systems. The former describes covering transportation demands arising from passengers or freights demanding transport from a given source origin to a target destination using a supply of vehicles, which are dispatched with respect to covering a set of objectives such as shortest-traveling time, energy-efficient operation, or their balanced distribution on the transport infrastructure. Then, transportation electrification describes the increasing penetration of electric vehicles in the transport system, which pose new challenges over traditional, i.e. combustion engine, vehicles such as possibily more limited ranges, which have to considered in accordance to or constrained by a given charging infrastructure. 

\subsection{Problem Statement}

Despite this situation, current approaches and model-based development methodologies for the design of transportation systems are not able to holistically address aforementioned challenges. On the one hand side, transportation infrastructures and control algorithms need to be holistically evaluated, based on the heterogenous systems they are composed of and the heterogenous requirements they have to adhere to. On the other hand side, current modeling approaches for system design do not offer appropriate domain abstractions in terms of their modeling complexity, or their provided structural or behavioral modeling capabilities to describe these systems on a required level of detail. In addition, the approaches do not offer support for evaluating heterogenous application scenarios in terms of a shared configuration space easing the modeling task, which supports reuse of modeling concepts and effective evaluation of possible design options. 
%\newpage

\subsection{Research questions}
With respect to these challenges, we pose the following research questions:
\begin{itemize}
	\item RQ1: How can we support the design and test of transportation infrastructures and control algorithms better?
	\item RQ2: Which modeling and simulation technique represents an appropriate abstraction for the domain?
	%\item RQ3: Which software architecture is appropriate for an integrated design and test environment?
	\item RQ3: Which application scenarios should be supported on top of this environment?
	\item RQ4: Which events to describe for the specific system, and of those, which events are relevant?
\end{itemize}

\subsection{Contribution}
% Previous approach - Complexity Reduction of simulation using DES, Formalization of system concepts using notation/foundation 
%To answer the above questions, we apply and combine two research methodologies.
%First we conduct a literature review to understand the state of the art in transportation system design and test.
%Second we use iterative and incremental software development with regular feedback from stakeholders to develop our a new dedicated approach.
To address these challenges and the above research questions, subsequently, we introduce a systematic and iterative approach for transportation system design.

To describe, evaluate and compare integrated transportation system design options systematically, we previously introduced an approach for modeling integrated intelligent transportation system properties using a formal foundation. However, due to the inherent complexity in defining large-scale problems and evaluating them using simulation, our approach was only applicable to limited scale, i.e. microscopic design problems, and allowed fixed simulation resolution only, where for instance detection of collisions between traffic participants, was dependant on discrete-time resolution.  

In this work, we improve upon our previous approach by employing Discrete Event Simulation (DES), which helps reduce simulation complexity significantly, thereby allowing one to now model and evaluate microscopic to macroscopic design problems using our proposed design abstraction. This is achieved by focusing on relevant events impacting the design problem at hand only, thereby reducing modeling effort, while omitting unimportant details negatively impacting simulation performance. In this work, we therefore introduce our approach and describe relevant events. 

% Showing validity of proposed approach, discussion of validity with respect to real-world phenomena, compared with other approaches from literature, i.e. differences 

\subsection{Structure}
%In the following, we first present related work on transportation system design and test in Section~\ref{sec:related}.
In the following, we describe the underlying system theory of our approach in Section~\ref{sec:theory}.
Then, in Section~\ref{sec:events}, we describe the events and decisions that must be considered for high-performance state computation using discrete event simulation. 
%In Section ~\ref{sec:related}, we investigate related work, and compare our approach.
%Afterwards, we explain our software architecture in Section~\ref{sec:arch}.
%Thereafter, we demonstrate three software applications in Section~\ref{sec:app}.
Finally, in Section~\ref{sec:con}, we conclude and provide an outlook on future work.

\newpage

\section{System theory}
% Briefly explain system theory of existing work
\label{sec:theory}
In the following, we explain the underlying system theory, which is based on~\cite{Ascher2014,Ascher2015,Ascher2016,Ascher2017}.
%In Section~\ref{sec:concepts} we introduce basic definitions and concepts, which can be used for transportation system design such as properties, states as well as simple and complex functional relations. 
%Then, in Section~\ref{sec:transitions} we show more complex functional relations over the previous concepts, their properties, and their states.
%Finally, in Section~\ref{sec:events} we describe the events and decisions that must be considered for high-performance state computation using discrete event simulation.


%\subsection{Basic definitions}
%\label{sec:concepts}
%In this subsection, we establish basic definitions for concepts, properties, states and simple functional relations in subsection \ref{sec:simple} and then, secondly, complex functional relations in \ref{sec:complex}.

%\subsubsection{Concepts, properties, states, and simple functional relations}
%\label{sec:simple}


Figure~\ref{fig:concepts} provides an overview of the concepts, their properties, and their states.
\begin{figure*}[t]
	\centering
	\includegraphics[scale=0.35]{../../diagrams/model/classes-v0.png}
	\caption{Concepts in UML class diagram notation}
	\label{fig:concepts}
\end{figure*}
We use intersections $i \in I$ and segments $s \in S$ for describing the drive infrastructure.
Then, we use locations $l \in L$ and charging stations $cs \in CS$ for describing the charge infrastructure.
Furthermore, we use locations $l$ and vehicles $v \in V$ for describing the transportation capacities.
Finally, we use location-times $lt \in LT$ and demands $d \in D$ for describing the transportation loads.
In the following, we describe each concept in more detail including its static (i.e.\ time-independent) properties and dynamic (i.e.\ time-dependent) states as well as simple constraints.

We describe intersections and segments in Section \ref{sec:intersections-segments}, locations and location-times in Section \ref{sec:locations-locationtimes}, as well as, finally, charging stations, demands and vehicles in Section \ref{sec:chargingstations-demands-vehicles}.

\subsection{Intersections and Segments}
\label{sec:intersections-segments}
In this Section, we subsequenly describe intersections as well as segments of the transportation infrastructure. These concepts are visualized in Figure \ref{fig:intersections-segments}.

\begin{figure}
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[scale=0.4]{../../concepts/intersection.png}
		\caption{Intersection}
		\label{fig:intersection}
	\end{subfigure}
	\hfill
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[scale=0.4]{../../concepts/segment.png}
		\caption{Segment}
		\label{fig:segment}
	\end{subfigure}
	\hfill
	\caption{Intersections and Segments}
	\label{fig:intersections-segments}	
\end{figure}

\noindent
\textbf{Intersections} (see Figure \ref{fig:intersection})
define the routing points of the drive infrastructure.
Each intersection must have a coordinate in the corresponding reference coordinate system.
Mathematically, intersections can be described as elements $i \in I$ with static property function
\begin{itemize}
	\item coordinate $P_{I.C}: I \rightarrow \mathbb{R}^3$.
\end{itemize}
\vspace{2mm}

\noindent
\textbf{Segments} (see Figure \ref{fig:segment})
define the straight roads of the drive infrastructure.
Each segment must define a source and a target intersection, which represent the start and the end coordinates of the straight road.
The length of the segment can be computed from the coordinates of the source and the target intersection.
Additionally, each segment must define a width and a maximum drive speed.
Mathematically, segments can be described as elements $s = (i_s, i_t) \in I \times I = S$ with source intersection $i_s$, target intersection $i_t$, and static property functions
\begin{itemize}
	\item length $P_{S.L}: S \rightarrow \mathbb{R}_0^+$ such that the value equals to the Euclidean distance between the coordinates of the source and the target intersection, i.e.\ $P_{S.L}(i_s, i_t) = |P_{I.C}(i_t) - P_{I.C}(i_s)|$,
	\item width $P_{S.W}: S \rightarrow \mathbb{R}^+$, and
	\item maximum drive speed $P_{S.MDS}: S \rightarrow \mathbb{R}^+$.
\end{itemize}

\subsection{Locations and Location-Times}
\label{sec:locations-locationtimes}	
In this Section, we subsequently describe locations and location-times on the transportation infrastructure.

\vspace{4mm}
\noindent
\textbf{Locations}
represent an auxiliary concept and define dedicated positions on the transportation infrastructure.
Each location must define a segment and a travelled distance on that segment.
Mathematically, locations can be described as elements $(s, d) \in S \times \mathbb{R}_0^+ = L$ with segment $s$ and distance $d$ such that $d \leq P_{S.L}(s)$.

\vspace{4mm}
\noindent
\textbf{Location-times}
 also represent an auxiliary concept and define dedicated positions on the transportation infrastructure at particular time points.
Each location-time must define a corresponding location and the desired time point.
Mathematically, location-times can be described as elements $(l, t) \in L \times \mathbb{T} = LT$ with location $l$ and time point $t$.

\noindent
\subsection{Charging Stations, Demands and Vehicles}
\label{sec:chargingstations-demands-vehicles}	
In this Section, we subsquently describe charging stations, demands as well as vehicles. These concepts are visualized in Figure \ref{fig:chargingstations-demands-vehicles}.
\vspace{4mm}

\begin{figure}
	\hfill
	\begin{subfigure}{.3\textwidth}
		\centering
		\includegraphics[scale=0.3]{../../concepts/charge-station.png}
		\caption{Charging Station}
		\label{fig:charging-station}	
	\end{subfigure}
	\hfill
	\begin{subfigure}{.3\textwidth}
		\centering
		\includegraphics[scale=0.5]{../../concepts/demand.png}
		\caption{Demand}
		\label{fig:demand}
	\end{subfigure}
	\hfill
	\begin{subfigure}{.3\textwidth}
		\centering
		\includegraphics[scale=0.7]{../../concepts/vehicle.png}
		\caption{Vehicle}
		\label{fig:vehicle}	
	\end{subfigure}

	\caption{Charging Stations, Demands and Vehicles}
	\label{fig:chargingstations-demands-vehicles}	
\end{figure}

\noindent
\textbf{Charging Stations} (see Figure \ref{fig:charging-station})
define the charging infrastructure for vehicles to refill their batteries.
Each charging station must define a location and a maximum charge speed.
Mathematically, charging stations can be described as elements $cs \in CS$ with static property functions
\begin{itemize}
	\item location $P_{CS.L}: CS \rightarrow L$ and
	\item maximum charge speed $P_{CS.MCS}: CS \rightarrow \mathbb{R}^+$.
\end{itemize}
Furthermore, the dynamic state of charging stations comprises the current vehicles and the current charge speed.
Mathematically, the state of charging stations $cs$ can be described using dynamic state functions with corresponding simple functional relations
\begin{itemize}
	\item current vehicle $S_{CS.CV}: CS \times \mathbb{T} \rightarrow V \cup \{\perp\}$, and
	\item current charge speed $S_{CS.CCS}: CS \times \mathbb{T} \rightarrow \mathbb{R}^+$ such that the value is smaller than or equal to the maximum charge speed of the charging station, i.e.\ $\forall t \in \mathbb{T}: S_{CS.CCS}(cs,t) \leq P_{CS.MCS}(cs)$.
\end{itemize}

\vspace{2mm}
\noindent
\textbf{Demands} (see Figure \ref{fig:demand})
 define the transportation loads that temporarily consume the transportation capacities.
Each demand must define a size, a pick-up location, a drop-off location, an earliest pick-up time, and a latest drop-off time.
Mathematically, demands can be described as elements $d \in D$ with static property functions such that

\begin{itemize}
	\item size $P_{D.S}: D \rightarrow \mathbb{R}^+$,
	\item pick-up location and earliest time $P_{D.PULT}: D \rightarrow LT$ with $P_{D.PULT}(d) = (l_d^{PULT},t_d^{PULT})$, and
	\item drop-off location and latest time $P_{D.DOLT}: D \rightarrow LT$ with $P_{D.DOLT}(d) = (l_d^{DOLT},t_d^{DOLT})$ such that the pick-up location is different from the drop-off location, i.e.\ $l_d^{PULT} \neq l_d^{DOLT}$, and the earliest pick-up time is before the latest drop-off time, i.e.\ $t_d^{PULT} < t_d^{DOLT}$.
\end{itemize}
Furthermore, the dynamic state of demands comprises the current vehicle and the current location.
Mathematically, the state of demands $d$ can be described using dynamic state functions with corresponding simple functional relations such that
\begin{itemize}
	\item current vehicle $S_{D.CV}: D \times \mathbb{T} \rightarrow V \cup \{\perp\}$, and
	\item current location $S_{D.CL}: D \times \mathbb{T} \rightarrow L$.
\end{itemize}
\vspace{2mm}
\noindent
\textbf{Vehicles} (see Figure \ref{fig:vehicle})
 define the transportation capacities available on the transportation infrastructure.
Each vehicle must define a maximum battery level, a maximum demand level, a maximum drive speed, and a maximum charge speed, an initial location, and an initial battery level.
Mathematically, vehicles can be described as elements $v \in V$ with static property functions
\begin{itemize}
	\item maximum battery level $P_{V.MBL}: V \rightarrow \mathbb{R}^+$,
	\item maximum demand level $P_{V.MDL}: V \rightarrow \mathbb{R}^+$,
	\item maximum drive speed $P_{V.MDS}: V \rightarrow \mathbb{R}^+$,
	\item maximum charge speed $P_{V.MCS}: V \rightarrow \mathbb{R}^+$,
	\item initial location $P_{V.IL}: V \rightarrow L$, and
	\item initial battery level $P_{V.IBL}: V \rightarrow \mathbb{R}_0^+$ such that that the value is greater than or equal to the minimum battery level and lower than or equal to the maximum battery level of the vehicle, i.e.\ $0. \leq P_{V.IBL}(v) \leq P_{V.MBL}(v)$,
\end{itemize}
Furthermore, the dynamic state of vehicles comprises the current location, the current demands, the current demand level, the current charging station, the current battery level, the current drive speed, and the current charge speed.
Mathematically, the state of vehicles $v$ can be described using dynamic state functions with corresponding simple functional relations
\begin{itemize}
	\item current demands $S_{V.CD}: V \times \mathbb{T} \rightarrow \mathbb{P}(D)$,
	\item current charging station $S_{V.CCS}: V \times \mathbb{T} \rightarrow CS \cup \{\perp\}$ such that, if the current charging station of the vehicle is not empty, the current vehicles of the charging station include the vehicle, i.e.\ $\forall (v,t) \in V \times \mathbb{T}: \exists cs \in CS: cs = S_{V.CSS}(v,t): cs \neq \perp \Leftrightarrow v \in S_{CS.CV}(cs,t)$,
	% Note: Can the following derived from former?
	\item current location $S_{V.CL}: V \times \mathbb{T} \rightarrow L$ such that, if the current charging station of the vehicle is not empty, the current vehicle location equals to the location of the charging station, i.e.\ $\forall (v,t) \in V \times \mathbb{T}, \exists cs \in CS: cs = S_{V.CCS}(v,t): cs \neq \perp \Rightarrow S_{V.CL}(v,t)=P_{CS.L}(cs)$,
	\item current battery level $S_{V.CBL}: V \times \mathbb{T} \rightarrow \mathbb{R}_0^+$ such that the value is smaller than or equal to the maximum battery level of the vehicle, i.e.\ $\forall (v,t) \in V \times \mathbb{T}: S_{V.CBL}(v,t) \leq P_{V.MBL}(v)$,
	% Note: Move to dynamic constraints?
	\item current demand level $S_{V.CDL}: V \times \mathbb{T} \rightarrow \mathbb{R}_0^+$ such that the value is smaller than or equal to the maximum demand level of the vehicle, i.e.\ $\forall (v,t) \in V \times \mathbb{T}: S_{V.CDL}(v,t) \leq P_{V.MDL}(v)$,
	
	
	%The current demand levels of the vehicles must be derived from the current demands of the vehicles and their sizes, i.e.\ $\forall t \in \mathbb{T}, v \in V:$
	%\[
	%S_{V.CDL}(v,t)=\sum_{d \in \mathcal{D}}^{}P_{D.S}(d) \textrm{ with } \mathcal{D}=S_{V.CD}(v,t)
	%\]
	
	%\item (ACTION!) current drive speed $S_{V.CDS}: S \times \mathbb{T}$ such that the value is smaller than or equal to the maximum drive speed of the vehicle, i.e.\ $\forall t \in \mathbb{T}: S_{V.CDS}(v,t) \leq P_{V.MDS}(v)$, and
	% Note: $\forall (v,t) \in V \times \mathbb{T}?
	%\item (ACTION!) current charge speed $S_{V.CCS}: S \times \mathbb{T}$ such that the value is smaller than or equal to the maximum charge speed of the vehicle, i.e.\ $\forall t \in \mathbb{T}: S_{V.CCS}(v,t) \leq P_{V.MCS}(v)$.
	% Note: $\forall (v,t) \in V \times \mathbb{T}?
\end{itemize}

% TODO GGF. STREICHEN
% TODO GGF. STREICHEN
% Fokus auf Eventbeschreibung
\noindent
In addition, vehicles define dynamic action functions (which only limit the time domain), such that

\begin{itemize}
	\item charge-start $A_{V.CS}: V \times \mathbb{T} \rightarrow \mathbb{B}$ only defined if vehicle is at charging station $\forall (v,t) \in V \times \mathbb{T}: \exists cs \in CS: P_{CS.L}(cs) = S_{V.CL}(v, t)$
	% TODO Location Time instead of Location
	\item charge-end $A_{V.CE}: V \times \mathbb{T} \rightarrow \mathbb{B}$ only if vehicle is at charging station $\forall (v,t) \in V \times \mathbb{T}: \exists cs \in CS: P_{CS.L}(cs) = S_{V.CL}(v, t)$
	\item pick-up $A_{V.DPU}: V \times \mathbb{T} \rightarrow \mathbb{B}$ only defined if vehicle is at demand pick-up location and pick-up time is after earliest pickup time and before latest drop-off time $\forall (v,t) \in V \times \mathbb{T}: \exists d \in D \wedge  P_{D.PULT}(d) = (l_d^{PULT},t_d^{PULT}) \wedge P_{D.DOLT}(d) = (l_d^{DOLT},t_d^{DOLT}): l_d^{PULT} = S_{V.CL}(v,t) \wedge t_d^{PULT} \leq t \leq t_d^{DOLT}$
	% Note replace with pickup event? 
	% Note: (not asked if not enough demand capacity left)
	% Note: Versus current location of domains
	\item drop-off $A_{V.DDO}: V \times \mathbb{T} \rightarrow \mathbb{B}$ only defined if vehicle is at demand drop-off location and drop-off time is after earliest pickup time and before latest drop-off time $\forall (v,t) \in V \times \mathbb{T}: \exists d \in D \wedge  P_{D.PULT}(d) = (l_d^{PULT},t_d^{PULT}) \wedge P_{D.DOLT}(d) = (l_d^{DOLT},t_d^{DOLT}): l_d^{DOLT} = S_{V.CL}(v,t) \wedge t_d^{PULT} \leq t \leq t_d^{DOLT}$
		% Note some redundancy with Pick-up
		% TODO
	\item route $A_{V.R}: V \times \mathbb{T} \rightarrow S$ only defined ...
	% Note: Route vs. current target segment
	\item drive speed $A_{V.DS}: V \times \mathbb{T} \rightarrow \mathbb{R}$ only defined if vehicle has a location $\forall (v,t) \in V \times \mathbb{T}: \exists (l, t) \in L \times \mathbb{T} \wedge l = (s, d) \in S \times \mathbb{R}_0^+: S_{V.CL}(v) = LT(l) \wedge d \leq P_{S.L}(s)$ and such that the value is smaller than or equal to the maximum drive speed of the vehicle, i.e.\ $\forall t \in \mathbb{T}: A_{V.DS}(v,t) \leq P_{V.MDS}(v)$.
		\item current charge speed $A_{V.CCS}: S \times \mathbb{T}$ such that the value is smaller than or equal to the maximum charge speed of the vehicle, i.e.\ $\forall (v,t) \in V \times \mathbb{T}: A_{V.CCS}(v,t) \leq P_{V.MCS}(v)$.
	% Note: $\forall (v,t) \in V \times \mathbb{T}?
	% TODO Check	
	

	
	\item Charge speed $A_{V.CS}: V \times \mathbb{T} \rightarrow \mathbb{R}$ only defined if vehicle is at charging station $\forall (v,t) \in V \times \mathbb{T}: \exists cs \in CS: P_{CS.L}(cs) = S_{V.L}(v)$
\end{itemize}
Then, for vehicles dynamic constraint functions we consider the following:
\begin{itemize}
	% TODO Collisions
	\item collisions TODO
	\item target segment not in list of outgoing segments of intersection $\forall (v,t) \in V \times \mathbb{T}: \exists s \in S \wedge s = (i_s, i_t) \in I \times I: A_{V.R}(v, t) \in Outgoing(i_t)$
	% Set P of outgoing edges
	% TODO \wedge Outgoing(i_t) = {P(i_t) | s' \in S} \and  \exists i_t, \exists i_t' \mathrm{such that} s' = (i_t, i_t')$
	% Note TODO "outgoing" function is not defined yet
	
	\item higher drive speed than supported by the vehicle $\forall (v,t) \in V \times \mathbb{T}: S_{V.CDS}(v,t) \leq P_{V.MDS}(v)$
	\item higher drive speed than allowed by the segment $\forall (v,t) \in V \times \mathbb{T}: \exists s \in S: S_{V.CDS}(v,t) \leq P_{S.MDS}(s)$
	% Note: Notation: Segments vs. States!
	\item higher charge speed than supported by the vehicle $\forall (v,t) \in V \times \mathbb{T}: S_{V.CCS}(v,t) \leq P_{V.MCS}(v)$
	\item higher charge speed than allowed by the charging station $\forall (cs,t) \in CS \times \mathbb{T}: S_{CS.CCS}(cs,t) \leq P_{CS.MCS}(cs)$
	% Note: Changed to: than allowed by segment to cs, a
	% Cover: cs,ccs<cs,mcs AND v,ccs<v,mcs, AND PLUS v,ccs<cs,mcs?
\end{itemize}

\section{Discrete events}
\label{sec:events}
Based on the system theory in terms of static property as well as dynamic state and action functions defined in Section \ref{sec:theory}, subsequently we describe discrete events for our model. For this, we describe routing events in Section \ref{sec:routing-events}, overtaking events in Section \ref{sec:overtaking-events}, demand events in Section \ref{sec:demand-events}, charging events in Section \ref{sec:charging-events}, and, finally, battery events in Section \ref{sec:battery-events}.

\subsection{Routing Events}
\label{sec:routing-events}
This Section describes routing events which occur based on vehicle positioning at the start or at the end of segments, and which are visualized in Figure \ref{fig:routing-events}.
\vspace{4mm}
\begin{figure}
	\centering
	\begin{subfigure}{.45\textwidth}
		\centering
		\includegraphics[scale=0.35]{../../events/vehicle-at-intersection-before.png}
		\caption{Vehicle arrives at segment end.}
		\label{fig:vehicle-at-intersection-before}
	\end{subfigure}
	\begin{subfigure}{.45\textwidth}
		\centering
		\includegraphics[scale=0.35]{../../events/vehicle-at-intersection-after.png}
		\caption{Vehicle arrives at segment start.}
		\label{fig:vehicle-at-intersection-after}
	\end{subfigure}
	\caption{Routing events.}
		\label{fig:routing-events}
\end{figure}



%\begin{wrapfigure}{r}{0.25\textwidth}
%	\centering
%		\includegraphics[scale=0.35]{../../events/vehicle-at-intersection-before.png}
%		%\caption{Vehicle at intersection before}
%		%\label{fig:vehicle-at-intersection-before}
%\end{wrapfigure}
%\begin{wrapfigure}{r}{0.25\textwidth}
%	\centering
%	\includegraphics[scale=0.35]{../../events/vehicle-at-intersection-after.png}
%	%\caption{Vehicle at intersection after}
%	%\label{fig:vehicle-at-intersection-after}
%\end{wrapfigure}


\noindent
\textbf{Vehicle arrives at segment end} (see Figure \ref{fig:vehicle-at-intersection-before})
occurs at time $t \in T$ if and only if there exists a vehicle $v \in V$ and a location $(s,d) \in L$ with segment $s \in S$ and traveled distance $d \in \mathbb{R}_0^+$ such that the vehicle $v$ at time $t$ is at location $(s,d)$, i.e. $S_{V.CL}(v,t) = (s,d)$, and the traveled distance $d$ on segment $s$ equals the length of the segment $s$, i.e. $P_{S.L}(s) = d$.

% such that $E_{V.LIB}: V \times \mathbb{T} \rightarrow \mathbb{B}$, which is only defined if the vehicles distance driven on the current segment equals the length of the current segment such that $\forall (v,t) \in V \times \mathbb{T}: \exists lt \in LT: S_{V.CL}(v,t) = lt \wedge lt = (l, t) \wedge l = (s, d) \wedge d = P_{S.L}(s)$
%\exists lt \in LT \wedge lt = (l, t) \in L \times \mathbb{T} \wedge l = (s, d) \in S \times \mathbb{R}_0^+: S_{V.CL}(v,t) 
\vspace{4mm}
\noindent
\textbf{Vehicle arrives at segment start} (see Figure \ref{fig:vehicle-at-intersection-after})
occurs at time $t \in T$ if and only if there exists a vehicle $v \in V$ and a location $(s,d) \in L$ with segment $s \in S$ and traveled distance $d \in \mathbb{R}_0^+$ such that the vehicle $v$ at time $t$ is at location $(s,d)$, i.e. $S_{V.CL}(v,t) = (s,d)$, and the traveled distance $d$ on segment $s$ is zero, i.e. $d = 0$. Note that the event vehicle at intersection after occurs concurrenly with event vehicle at intersection before.
% Rework for event occuring once
%For the event of a vehicle being located after an intersection to occur, we consider a vehicle $\exists v \in V$ at time $t \in T$, such that $E_{V.LIA}: V \times \mathbb{T} \rightarrow \mathbb{B}$ which is only defined if the vehicles distance driven on the current segments is smaller than the length of the current segment $\forall (v,t) \in V \times \mathbb{T}: \exists lt \in LT: S_{V.CL}(v,t) = lt \wedge lt = (l, t) \wedge l = (s, d) \wedge d < P_{S.L}(s)$

\vspace{4mm}

\subsection{Overtaking Events}
\label{sec:overtaking-events}

This Section describes overtaking events which occur based on the positioning between multiple vehicles, and which are visualized in Figure \ref{fig:overtaking-events}.

\begin{figure}
	\centering
	\begin{subfigure}{.45\textwidth}
	\centering
	\includegraphics[scale=0.35]{../../events/faster-vehicle-front-at-slower-vehicle-back.png}
	\caption{Faster vehicle f.\ at slower vehicle b.}
	\label{fig:faster-vehicle-front-at-slower-vehicle-back}
	\end{subfigure}
	\begin{subfigure}{.45\textwidth}
	\centering
	\includegraphics[scale=0.35]{../../events/slower-vehicle-front-at-faster-vehicle-back.png}
	\caption{Slower vehicle f.\ at faster vehicle b.}
	\label{fig:slower-vehicle-front-at-faster-vehicle-back}
	\end{subfigure}
	\caption{Overtaking events.}
	\label{fig:overtaking-events}
\end{figure}


\noindent
\textbf{Faster vehicle front at slower vehicle back} (see Figure \ref{fig:faster-vehicle-front-at-slower-vehicle-back})
occurs...

\vspace{4mm}

\noindent
\textbf{Slower vehicle front at faster vehicle back} (see Figure \ref{fig:slower-vehicle-front-at-faster-vehicle-back})
occurs...


\subsection{Demand Events}
\label{sec:demand-events}
This Section describes demand events which occur based on demand appearance or vehicle positioning at demand pick-up or demand drop-off locations, which are visualized in Figure \ref{fig:demand-events}.
\vspace{4mm}

\begin{figure}
	\begin{subfigure}{.32\textwidth}
		\centering
		\includegraphics[scale=0.35]{../../events/demand.png}
		\caption{Demand appears.}
		\label{fig:demand-appears}
	\end{subfigure}
	\hfill
	\begin{subfigure}{.32\textwidth}
		\centering
		\includegraphics[scale=0.35]{../../events/vehicle-at-demand-pick-up.png}
		\caption{Vehicle at demand pick-up.}
		\label{fig:vehicle-at-demand-pick-up}
	\end{subfigure}
	\hfill
	\begin{subfigure}{.32\textwidth}
		\centering
		\includegraphics[scale=0.35]{../../events/vehicle-at-demand-drop-off.png}
		\caption{Vehicle at demand drop-off.}
		\label{fig:vehicle-at-demand-drop-off}
	\end{subfigure}
\hfill
	\caption{Demand events.}
	\label{fig:demand-events}	
\end{figure}

\noindent
\textbf{Demand appears} (see Figure \ref{fig:demand-appears}) occurs...

\vspace{4mm}

\noindent
\textbf{Vehicle arrives at demand pick-up location} (see Figure \ref{fig:vehicle-at-demand-pick-up}) 
occurs
For the event of a vehicle being located at a demand pick-up location, we consider a vehicle $\exists v \in V$ at time $t \in T$, such that 
$E_{V.DPU}: V \times \mathbb{T} \rightarrow \mathbb{B}$ only defined if vehicle is at demand pick-up location $\forall (v,t) \in V \times \mathbb{T}: \exists d \in D, \exists t \in T: P_{D.PULT}(d) = (l_d^{PULT},t_d^{PULT}) \wedge l_d^{PULT} = S_{V.CL}(v,t)$

\vspace{4mm}

\noindent
\textbf{Vehicle arrives at demand drop-off location} (see Figure \ref{fig:vehicle-at-demand-drop-off})
occurs
For the event of a vehicle being located at a demand drop-off location, we consider a vehicle $\exists v \in V$ at time $t \in T$, such that 
$E_{V.DDO}: V \times \mathbb{T} \rightarrow \mathbb{B}$ only defined if vehicle is at demand pick-up location $\forall (v,t) \in V \times \mathbb{T}: \exists d \in D, \exists t \in T: P_{D.DOLT}(d) = (l_d^{DOLT},t_d^{DOLT}) \wedge l_d^{DOLT} = S_{V.CL}(v,t)$

\vspace{4mm}


\subsection{Charging Events}
This Section describes charging events which occur based on vehicle positioning at charging stations or based on their charge speed.

\vspace{4mm}

\label{sec:charging-events}
\noindent
\textbf{Vehicle arrives at charging station}
occurs at time $t \in T$ if and only if there exists a vehicle $v \in V$ and a charging station $cs \in CS$ with location $l = P_{CS.L}(cs)$, such that vehicle $v$ at time $t$ is at location $l$, i.e. $S_{V.CL}(v, t) = l$, and for all previous times $t' \in T$ with $t' < t$ where vehicle $v$ was at location $l$, i.e. $S_{V.CL}(v, t') = l$, there exists an intermediate time $t'' \in T$ with $t' < t'' < t$, such that vehicle $v$ was not at location $l$, i.e. $S_{V.CL}(v, t'') \neq l$.

\vspace{4mm}
\noindent
\textbf{Vehicle starts charging}
occurs at time $t \in T$ if and only if there exists a vehicle $v \in V$ such that current charge speed of vehicle $v$ at time $t$ is not zero, i.e. $S_{V.CCS}(v,t) \neq 0$, and for all previous times $t' \in T$ with $t' < t$, where the current charge speed of vehicle $v$ is not zero, i.e. $S_{V.CCS}(v,t') \neq 0$, there exists an intermediate time $t'' \in T$ with $t' < t'' < t$, such that the current charge speed of vehicle $v$ is zero, i.e. $S_{V.CCS}(v,t'') = 0$.


%occurs... from none to some, and previously some.
%\begin{figure}[htbp]
%	\centering
%	\missingfigure[figwidth=88mm]{Vehicle battery full}
%	\caption{Vehicle battery full}
%	\label{fig:vehicle-battery-full}
%\end{figure}
%For the event of a vehicles battery level being full to occur, we consider a vehicle $\exists v \in V$ at time $t \in T$, such that $E_{V.FBL}: V \times \mathbb{T} \rightarrow \mathbb{B}$, which is only defined if the vehicles battery level equals the vehicles maximum battery level such that $\forall (v,t) \in V \times \mathbb{T}: \exists t \in T: S_{V.CBL}(v,t) = P_{V.MBL}(v)$

\vspace{4mm}
\noindent
\textbf{Vehicle stops charging}
occurs at time $t \in T$ if and only if there exists a vehicle $v \in V$ such that current charge speed of vehicle $v$ at time $t$ is zero, i.e. $S_{V.CCS}(v,t) = 0$, and for all previous times $t' \in T$ with $t' < t$, where the current charge speed of vehicle $v$ is zero, i.e. $S_{V.CCS}(v,t') = 0$, there exists an intermediate time $t'' \in T$ with $t' < t'' < t$, such that the current charge speed of vehicle $v$ is not zero, i.e. $S_{V.CCS}(v,t'') \neq 0$.

\vspace{4mm}
\noindent
\subsection{Battery Events}
\label{sec:battery-events}
This Section describes battery events which occur based on vehicle battery level.
\vspace{4mm}

\noindent
\textbf{Vehicle battery becomes empty}
occurs at time $t \in T$ if and only if there exists a vehicle $v \in V$ such that the current battery level of vehicle $v$ at time $t$ is zero, i.e. $S_{V.CBL}(v,t) = 0$ and for all previous times $t' \in T$ with $t' < t$, where the current battery level of vehicle $v$ was zero, i.e. $S_{V.CBL}(v,t') = 0$, there exists an intermediate time $t'' \in T$ with $t' < t'' < t$, such that the current battery level of vehicle $v$ was not zero, i.e. $S_{V.CBL}(v,t'') \neq 0$.

\vspace{4mm}
\noindent
\textbf{Vehicle battery becomes full}
occurs at time $t \in T$ if and only if there exists a vehicle $v \in V$ such that the current battery level of vehicle $v$ at time $t$ equals the maximum battery level of vehicle $v$, i.e. $S_{V.CBL}(v,t) = P_{V.MBL}(v)$, and for all previous times $t' \in T$ with $t' < t$, where the current battery level of vehicle $v$ equals the maximum battery level of vehicle $v$, i.e. $S_{V.CBL}(v,t') = P_{V.MBL}(v)$, there exists an intermediate time $t'' \in T$ with $t' < t'' < t$, such that the current battery level of vehicle $v$ does not equal the maximum battery level of vehicle $v$, i.e. $S_{V.CBL}(v,t'') \neq P_{V.MBL}(v)$.

%\begin{figure}[htbp]
%	\centering
%	\missingfigure[figwidth=88mm]{Vehicle battery empty}
%	\caption{Vehicle battery empty}
%	\label{fig:vehicle-battery-empty}
%\end{figure}
% TODO Minimum battery level as a constant
%For the event of a vehicles battery level being empty to occur, we consider a vehicle $\exists v \in V$ at time $t \in T$, such that $E_{V.EBL}: V \times \mathbb{T} \rightarrow \mathbb{B}$, which is only defined if the vehicles battery level equals the vehicles maximum battery level such that $\forall (v,t) \in V \times \mathbb{T}: \exists t \in T: S_{V.CBL}(v,t) = 0.$

\section{Conclusion and Outlook}
\label{sec:con}
TODO

\bibliographystyle{plain}
\bibliography{main}
\end{document}
